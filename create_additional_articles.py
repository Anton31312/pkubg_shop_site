#!/usr/bin/env python
"""
Скрипт для создания дополнительных тестовых статей.
"""
import os
import sys
import django

# Настройка Django
os.environ.setdefault('DJANGO_SETTINGS_MODULE', 'pkubg_ecommerce.settings')
django.setup()

from django.contrib.auth import get_user_model
from articles.models import Article, ArticleCategory, ArticleTag

User = get_user_model()

def create_additional_articles():
    """Создает дополнительные тестовые статьи."""
    
    # Получаем администратора
    admin_user = User.objects.filter(role='admin').first()
    if not admin_user:
        admin_user = User.objects.filter(is_superuser=True).first()
    
    if not admin_user:
        print("Администратор не найден!")
        return
    
    # Создаем дополнительные категории
    categories_data = [
        ('nutrition', 'Питание и диета'),
        ('health-tips', 'Советы по здоровью'),
        ('supplements', 'БАДы и добавки')
    ]
    
    categories = {}
    for slug, name in categories_data:
        category, created = ArticleCategory.objects.get_or_create(
            slug=slug,
            defaults={'name': name}
        )
        categories[slug] = category
    
    # Создаем дополнительные теги
    tags_data = [
        ('nutrition', 'Питание'),
        ('vitamins', 'Витамины'),
        ('healthy-lifestyle', 'Здоровый образ жизни'),
        ('diet', 'Диета'),
        ('supplements', 'Добавки')
    ]
    
    tags = {}
    for slug, name in tags_data:
        tag, created = ArticleTag.objects.get_or_create(
            slug=slug,
            defaults={'name': name}
        )
        tags[slug] = tag
    
    # Статьи для создания
    articles_data = [
        {
            'title': 'Основы здорового питания: что нужно знать каждому',
            'slug': 'healthy-nutrition-basics',
            'category': categories['nutrition'],
            'tags': [tags['nutrition'], tags['healthy-lifestyle']],
            'excerpt': 'Узнайте основные принципы здорового питания, которые помогут вам поддерживать хорошее самочувствие и энергию на протяжении всего дня.',
            'content': '''
<h2>Введение</h2>
<p>Здоровое питание — это основа хорошего самочувствия и долголетия. В этой статье мы рассмотрим основные принципы, которые помогут вам составить сбалансированный рацион.</p>

<h3>Основные принципы здорового питания</h3>
<ul>
<li><strong>Разнообразие:</strong> Включайте в рацион продукты из всех групп</li>
<li><strong>Умеренность:</strong> Контролируйте размер порций</li>
<li><strong>Регулярность:</strong> Питайтесь в одно и то же время</li>
<li><strong>Качество:</strong> Выбирайте натуральные продукты</li>
</ul>

<h3>Что включить в рацион</h3>
<p>Ваш ежедневный рацион должен включать:</p>
<ul>
<li>Овощи и фрукты (5-9 порций в день)</li>
<li>Цельнозерновые продукты</li>
<li>Белковые продукты (мясо, рыба, бобовые)</li>
<li>Молочные продукты или их альтернативы</li>
<li>Здоровые жиры (орехи, авокадо, оливковое масло)</li>
</ul>

<h3>Чего следует избегать</h3>
<ul>
<li>Избыточного количества сахара</li>
<li>Трансжиров</li>
<li>Чрезмерного потребления соли</li>
<li>Обработанных продуктов</li>
</ul>
            ''',
            'is_published': True
        },
        {
            'title': 'Витамины и минералы: полное руководство',
            'slug': 'vitamins-minerals-guide',
            'category': categories['supplements'],
            'tags': [tags['vitamins'], tags['supplements'], tags['healthy-lifestyle']],
            'excerpt': 'Подробное руководство по витаминам и минералам: какие нужны организму, в каких продуктах содержатся и когда стоит принимать добавки.',
            'content': '''
<h2>Зачем нужны витамины и минералы</h2>
<p>Витамины и минералы — это микронутриенты, которые необходимы организму для нормального функционирования. Они участвуют в обмене веществ, поддерживают иммунную систему и обеспечивают энергией.</p>

<h3>Основные витамины</h3>
<h4>Витамин A</h4>
<ul>
<li><strong>Функции:</strong> Зрение, иммунитет, рост клеток</li>
<li><strong>Источники:</strong> Морковь, сладкий картофель, шпинат</li>
<li><strong>Суточная норма:</strong> 900 мкг для мужчин, 700 мкг для женщин</li>
</ul>

<h4>Витамин C</h4>
<ul>
<li><strong>Функции:</strong> Антиоксидант, синтез коллагена, иммунитет</li>
<li><strong>Источники:</strong> Цитрусовые, ягоды, болгарский перец</li>
<li><strong>Суточная норма:</strong> 90 мг для мужчин, 75 мг для женщин</li>
</ul>

<h4>Витамин D</h4>
<ul>
<li><strong>Функции:</strong> Здоровье костей, иммунитет</li>
<li><strong>Источники:</strong> Солнечный свет, жирная рыба, обогащенные продукты</li>
<li><strong>Суточная норма:</strong> 15 мкг (600 МЕ)</li>
</ul>

<h3>Важные минералы</h3>
<h4>Кальций</h4>
<ul>
<li><strong>Функции:</strong> Здоровье костей и зубов, мышечные сокращения</li>
<li><strong>Источники:</strong> Молочные продукты, зеленые листовые овощи</li>
<li><strong>Суточная норма:</strong> 1000 мг</li>
</ul>

<h4>Железо</h4>
<ul>
<li><strong>Функции:</strong> Транспорт кислорода, энергетический обмен</li>
<li><strong>Источники:</strong> Красное мясо, бобовые, шпинат</li>
<li><strong>Суточная норма:</strong> 8 мг для мужчин, 18 мг для женщин</li>
</ul>

<h3>Когда нужны добавки</h3>
<p>Добавки могут быть полезны в следующих случаях:</p>
<ul>
<li>Дефицит определенных витаминов или минералов</li>
<li>Ограниченная диета (веганство, аллергии)</li>
<li>Беременность и кормление грудью</li>
<li>Пожилой возраст</li>
<li>Определенные заболевания</li>
</ul>
            ''',
            'is_published': True
        },
        {
            'title': '10 простых советов для здорового образа жизни',
            'slug': 'healthy-lifestyle-tips',
            'category': categories['health-tips'],
            'tags': [tags['healthy-lifestyle'], tags['nutrition']],
            'excerpt': 'Простые и эффективные советы, которые помогут вам вести здоровый образ жизни без кардинальных изменений в распорядке дня.',
            'content': '''
<h2>Простые шаги к здоровой жизни</h2>
<p>Здоровый образ жизни не требует кардинальных изменений. Небольшие, но постоянные усилия могут принести значительные результаты.</p>

<h3>1. Пейте больше воды</h3>
<p>Старайтесь выпивать не менее 8 стаканов воды в день. Вода помогает поддерживать все функции организма и улучшает самочувствие.</p>

<h3>2. Двигайтесь каждый день</h3>
<p>Даже 30 минут ходьбы в день могут значительно улучшить ваше здоровье. Найдите активность, которая вам нравится.</p>

<h3>3. Ешьте больше овощей и фруктов</h3>
<p>Старайтесь включать овощи и фрукты в каждый прием пищи. Они богаты витаминами, минералами и клетчаткой.</p>

<h3>4. Высыпайтесь</h3>
<p>Взрослым необходимо 7-9 часов сна в сутки. Качественный сон важен для восстановления организма.</p>

<h3>5. Управляйте стрессом</h3>
<p>Найдите здоровые способы справляться со стрессом: медитация, йога, хобби или общение с близкими.</p>

<h3>6. Ограничьте обработанные продукты</h3>
<p>Сократите потребление продуктов с высоким содержанием сахара, соли и трансжиров.</p>

<h3>7. Поддерживайте социальные связи</h3>
<p>Общение с друзьями и семьей важно для психического здоровья и общего благополучия.</p>

<h3>8. Регулярно проходите медосмотры</h3>
<p>Профилактические осмотры помогают выявить проблемы на ранней стадии.</p>

<h3>9. Откажитесь от вредных привычек</h3>
<p>Курение и чрезмерное употребление алкоголя значительно вредят здоровью.</p>

<h3>10. Будьте позитивными</h3>
<p>Позитивное мышление и благодарность помогают улучшить качество жизни и общее самочувствие.</p>
            ''',
            'is_published': True
        }
    ]
    
    # Создаем статьи
    for article_data in articles_data:
        if Article.objects.filter(slug=article_data['slug']).exists():
            print(f"Статья '{article_data['title']}' уже существует!")
            continue
        
        tags_to_add = article_data.pop('tags')
        article_data['author'] = admin_user
        
        article = Article.objects.create(**article_data)
        article.tags.set(tags_to_add)
        
        print(f"Создана статья: {article.title}")
    
    print(f"\nВсего статей в базе: {Article.objects.count()}")
    print(f"Опубликованных статей: {Article.objects.filter(is_published=True).count()}")

if __name__ == '__main__':
    create_additional_articles()